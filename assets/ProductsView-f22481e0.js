import{T as L}from"./TitleComponent-2e52f0f4.js";import{p as f}from"./produceStore-727c8f72.js";import{c as k}from"./cartStore-eef63568.js";import{a as w,m as v}from"./pinia-9491ed26.js";import{m as S}from"./modalMixin-c2fb7250.js";import{S as U}from"./sweetalert2.all-4df3b2fe.js";import{r as V}from"./index-b2210380.js";import{k as T,l as D,n as y}from"./runtime-dom.esm-bundler-b8fd4e16.js";import{ba as P,ak as i,m as c,n as t,a4 as C,F as u,au as b,aK as r,b4 as x,t as M,aw as g,u as m}from"./_plugin-vue_export-helper-bc03d341.js";import"./bootstrap.esm-06211441.js";const Q={data(){return{product:{imgUrls:[]},sortBy:"price",ascending:"",onePage:6,currentPage:1,selectedCategory:"",searchQuery:"",addBtn:!1}},components:{},watch:{ascending:{handler(){this.sortByDate()}}},computed:{...w(f,["products","categories"]),pageCount(){return Math.ceil(this.filteredProducts.length/this.onePage)},paginatedProducts(){const s=(this.currentPage-1)*this.onePage,o=s+this.onePage;return this.filteredProducts.slice(s,o)},filteredProducts(){let s=this.products;return this.selectedCategory&&(s=s.filter(o=>o.group===this.selectedCategory),this.currentPage=1,this.$nextTick(()=>{window.scrollTo(0,0)})),this.searchQuery&&(s=s.filter(o=>o.title===this.searchQuery),this.currentPage=1),s}},mixins:[S],methods:{...v(k,["addToCart"]),...v(f,["getProducts","getPage","text"]),getDetail(s){this.modal.show(),this.product=s},sortByDate(){return this.products.sort((s,o)=>this.ascending?o[this.sortBy]-s[this.sortBy]:s[this.sortBy]-o[this.sortBy]),this.products},goToPage(s){this.currentPage=s,window.scrollTo(0,0)},addBtnnn(s){this.userId?(this.addBtn=!0,setTimeout(()=>{this.addToCart(this.userId,s),this.addBtn=!1},500)):U.fire({title:"請先登入會員",icon:"error",confirmButtonText:"前往登入",customClass:{confirmButton:"btn btn-outline-info"},buttonsStyling:!1}).then(o=>{o.isConfirmed&&V.push("login")})}},mounted(){this.getProducts(),this.userId=localStorage.getItem("userId")}},R={class:"row"},q={class:"col-12 col-md-2"},z={class:"list-group text-center"},j=t("li",{class:"list-group-item bg-secondary fw-bold"},"商品分類",-1),A=t("div",{type:"button",style:{display:"block"}},"全部商品",-1),N=[A],E=["onClick"],F=["disabled"],K={class:"col-12 col-md-10"},G={class:"d-flex flex-column flex-md-row justify-content-md-between"},H=t("option",{value:"",disabled:""},"排序方式",-1),J=t("option",{value:""},"最新上架",-1),O=t("option",{value:!0},"價格高到低",-1),W=t("option",{value:!1},"價格低到高",-1),X=[H,J,O,W],Y={class:"row"},Z={class:"card productCard hoverImg"},tt=["onClick"],et=["src"],st={class:"card-body"},ot={class:"card-title text-truncate"},nt={class:"card-text"},it={key:0},ct=["onClick"],rt={key:1,type:"button",class:"btn btn-secondary text-white",disabled:""},lt=t("span",{class:"spinner-grow spinner-grow-sm",role:"status","aria-hidden":"true"},null,-1),at={key:1,type:"button",class:"btn btn-outline-secondary",disabled:""},dt={class:"pagination justify-content-center mt-3"},ut=["onClick"],ht={class:"modal fade productInfo",ref:"modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},_t={class:"modal-dialog"},pt={class:"modal-content"},gt={class:"modal-header"},mt={class:"modal-title",id:"exampleModalLabel"},bt=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),yt=["src"],ft={class:"p-3"},vt={class:"badge bg-secondary"},Ct={class:"card-title mt-1 mb-2"},kt={class:"card-text"},xt={class:"card-text me-2"},wt={class:"modal-footer"},Pt={key:1,type:"button",class:"btn btn-outline-secondary",disabled:""};function $t(s,o,_,$,n,l){var h;return i(),c(u,null,[t("div",R,[t("div",q,[t("ul",z,[j,t("li",{class:C(["list-group-item",{"bg-secondary text-white":n.selectedCategory===""}]),onClick:o[0]||(o[0]=e=>n.selectedCategory="")},N,2),(i(!0),c(u,null,b(s.categories,(e,a)=>(i(),c("li",{class:C(["list-group-item",{"bg-secondary text-white":n.selectedCategory===e}]),key:a,onClick:p=>n.selectedCategory=e},[t("div",{disabled:n.selectedCategory===e,type:"button",style:{display:"block"}},r(e),9,F)],10,E))),128))])]),t("div",K,[t("div",G,[x(t("select",{"onUpdate:modelValue":o[1]||(o[1]=e=>n.ascending=e)},X,512),[[T,n.ascending]]),x(t("input",{type:"text","onUpdate:modelValue":o[2]||(o[2]=e=>n.searchQuery=e),placeholder:"請輸入商品名稱"},null,512),[[D,n.searchQuery,void 0,{lazy:!0}]])]),t("div",Y,[(i(!0),c(u,null,b(l.paginatedProducts,e=>(i(),c("div",{key:e.id,class:"col-md-4 col-6 gy-3 d-flex flex-wrap"},[t("div",Z,[t("div",{class:"productBtn",role:"button",style:{position:"relative",height:"100%",overflow:"hidden"},onClick:y(a=>l.getDetail(e),["prevent"])},[t("img",{src:e.imgUrls,class:"card-img-top",alt:"product.title",style:{height:"100%","object-fit":"cover"}},null,8,et)],8,tt),t("div",st,[t("h5",ot,r(e.title),1),t("p",nt,"$ "+r(e.price)+" 元",1),e.sell?(i(),c("div",it,[n.addBtn?(i(),c("button",rt,[lt,M(" 加入中... ")])):(i(),c("button",{key:0,type:"button",class:"btn btn-secondary",onClick:y(a=>l.addBtnnn(e.id),["prevent"])}," 加入購物車 ",8,ct))])):(i(),c("button",at," 商品缺貨 "))])])]))),128))])])]),t("div",dt,[(i(!0),c(u,null,b(l.pageCount,e=>(i(),c("button",{class:C(["page-link",{"bg-secondary text-white":n.currentPage===e}]),key:e,onClick:a=>l.goToPage(e)},r(e),11,ut))),128))]),t("div",ht,[t("div",_t,[t("div",pt,[t("div",gt,[t("h5",mt,r(n.product.title),1),bt]),t("div",null,[t("div",null,[t("img",{src:(h=n.product)==null?void 0:h.imgUrls,class:"card-img-top primary-image",alt:"主圖",style:{height:"500px"}},null,8,yt),t("div",ft,[t("span",vt,r(n.product.group),1),t("h5",Ct,r(n.product.title),1),t("p",kt,"商品描述："+r(n.product.content),1),t("p",xt,"價格："+r(n.product.price)+" 元",1)])])]),t("div",wt,[n.product.sell?(i(),c("button",{key:0,type:"button",class:"btn btn-secondary text-white",onClick:o[3]||(o[3]=y(e=>s.addToCart(n.product.id),["prevent"]))}," 加入購物車 ")):(i(),c("button",Pt," 缺貨中 "))])])])],512)],64)}const Bt=P(Q,[["render",$t]]),It={data(){return{cart:[]}},computed:{...w(k,["loading","index","cartList","check","total"]),totalPrice(){let s=0;return this.cartList.carts.forEach(o=>{var _;s+=o.qty*((_=o.product)==null?void 0:_.price)}),s}},methods:{...v(k,["delCart","setCartQty","getCart","delCartAll","checkCart","upCart"]),goCheck(){this.checkCart(this.cartList.carts,this.totalPrice),this.$router.push("/check")}},mounted(){this.userId=localStorage.getItem("userId"),this.getCart(this.userId)}},Tt={key:0,class:"col-12 text-center"},Lt=t("h4",null,"購物車沒有任何品項",-1),St=[Lt],Ut={key:1},Vt=t("hr",null,null,-1),Dt={class:"col-2"},Mt=["src"],Qt={class:"col-3 text-truncate"},Rt={class:"col-2"},qt={class:"col-2"},zt=["onUpdate:modelValue","onChange","disabled"],jt=["value"],At={class:"col-2"},Nt={class:"col-1",role:"button"},Et=t("hr",null,null,-1),Ft={class:"text-end"},Kt={style:{"margin-left":"75%","margin-top":"10%"}},Gt=t("div",null,null,-1);function Ht(s,o,_,$,n,l){const h=g("BootstrapIcon");return i(),c(u,null,[s.cartList.carts.length?(i(),c("div",Ut,[t("p",{role:"button",onClick:o[0]||(o[0]=e=>s.delCartAll(this.userId)),style:{display:"inline"}}," 清空購物車 "),Vt,(i(!0),c(u,null,b(s.cartList.carts,e=>{var a,p,B,I;return i(),c("div",{class:"row mb-4",key:e.id},[t("div",Dt,[t("img",{src:(a=e.product)==null?void 0:a.imgUrls,class:"table-image",alt:"產品圖片",style:{width:"50px"}},null,8,Mt)]),t("div",Qt,r((p=e.product)==null?void 0:p.title),1),t("div",Rt,r((B=e.product)==null?void 0:B.price),1),t("div",qt,[x(t("select",{class:"form-select-sm","onUpdate:modelValue":d=>e.qty=d,onChange:d=>s.setCartQty(this.userId,e),disabled:s.loading===e.id},[(i(),c(u,null,b(20,d=>t("option",{value:d,key:d+123},r(d),9,jt)),64))],40,zt),[[T,e.qty]])]),t("div",At,r(e.qty*((I=e.product)==null?void 0:I.price)),1),t("div",Nt,[m(h,{icon:"trash-fill",class:"me-1",onClick:y(d=>s.delCart(this.userId,e.id),["prevent"])},null,8,["onClick"])])])}),128)),Et,t("h5",Ft,"總金額："+r(l.totalPrice)+" 元",1),t("div",Kt,[t("button",{type:"button",class:"btn btn-secondary text-white",onClick:o[1]||(o[1]=(...e)=>l.goCheck&&l.goCheck(...e))}," 前往結帳 ")])])):(i(),c("div",Tt,St)),Gt],64)}const Jt=P(It,[["render",Ht]]),Ot={data(){return{clearData:!1}},components:{TitleComponent:L,ProductComponent:Bt,CartComponent:Jt},computed:{...w(f,["categories"])},methods:{...v(f,["getProducts"])},mounted(){this.getProducts()}},Wt={class:"container pt-5"},Xt={type:"button",class:"btn btn-outline-secondary border border-secondary border-4 cartBtn shadow",style:{"z-index":"1",position:"fixed",bottom:"80px",right:"3%","border-radius":"50%",padding:"10px"}},Yt={class:"offcanvas offcanvas-end",tabindex:"-1",id:"offcanvasRight","aria-labelledby":"offcanvasRightLabel"},Zt=t("div",{class:"offcanvas-header bg-secondary text-white"},[t("h5",{id:"offcanvasRightLabel"},"購物車內容"),t("button",{type:"button",class:"btn-close text-reset","data-bs-dismiss":"offcanvas","aria-label":"Close"})],-1),te={class:"offcanvas-body"};function ee(s,o,_,$,n,l){const h=g("BootstrapIcon"),e=g("CartComponent"),a=g("TitleComponent"),p=g("ProductComponent");return i(),c("div",Wt,[t("button",Xt,[m(h,{"data-bs-toggle":"offcanvas","data-bs-target":"#offcanvasRight","aria-controls":"offcanvasRight",icon:"cart-fill",size:"2x",class:"m-2"})]),t("div",Yt,[Zt,t("div",te,[m(e)])]),m(a,{title:s.$t("title.products"),class:"text-center mt-5 mb-5"},null,8,["title"]),m(p)])}const he=P(Ot,[["render",ee]]);export{he as default};
